<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
	<link rel="icon" type="image/x-icon" href="/enemy/static/assets/favicon.ico">
	<title>Arknemy</title>
	<link rel="stylesheet" href="enemy.css">
</head>
<body style="background-color: #363535;">
	<div class="container">
		<header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
		<a href="/enemy/" class="d-flex align-items-center me-md-auto text-dark text-decoration-none">
			<img src="/enemy/static/assets/icon.png" style="width: 60px; margin-right:.5em" >
			<span class="display-5" style="color: white;">Arknemy</span>
		</a>
		<ul class="nav nav-pills">
			<li class="nav-item"><a href="/enemy/" class="nav-link active">Enemies</a></li>
		</ul>
		</header>
	</div>

	<div class="container" id="mainDiv">
		<input type="search" class="form-control" placeholder="Enter enemy name:" style="height: 32px; width: 95%; margin:auto; margin-bottom: 24px; box-shadow: 3px 3px 3px;">

		<div class="filterWidget">
			<h5>Filter</h5>
			<hr/>
			<div style="margin-bottom: 15px;">
				<p style="display:inline; margin-right: 18px;">Enemy Level:</p>
				<input type="checkbox" id='bnormal' name="bnormal" class='cboxButton' />
				<label for='bnormal' style="font-size: 14px; margin-right: 6px;">Normal</label>
				<input type="checkbox" id="belite" name="belite" class='cboxButton' />
				<label for='belite' style="font-size: 14px; margin-right: 6px;">Elite</label>
				<input type="checkbox" id="bboss" name="bboss" class='cboxButton' />
				<label for='bboss' style="font-size: 14px;">Boss</label>
			</div>
			<div style="margin-bottom: 15px;">
				<p style="display:inline; margin-right: 20px">Enemy Race:</p>
				<input type="checkbox" id='binfcrea' name="binfcrea" class='cboxButton' />
				<label for='binfcrea' style="font-size: 14px; margin-right: 6px;">Infected Creature</label>
				<input type="checkbox" id='bdrone' name="bdrone" class='cboxButton' />
				<label for='bdrone' style="font-size: 14px; margin-right: 6px;">Drone</label>
				<input type="checkbox" id='bsarkaz' name="bsarkaz" class='cboxButton' />
				<label for='bsarkaz' style="font-size: 14px; margin-right: 6px;">Sarkaz</label>
				<input type="checkbox" id='bpossessed' name="bpossessed" class='cboxButton' />
				<label for='bpossessed' style="font-size: 14px; margin-right: 6px;">Possessed</label>
				<input type="checkbox" id='bseamon' name="bseamon" class='cboxButton' />
				<label for='bseamon' style="font-size: 14px; margin-right: 6px;">Sea Monster</label>
				<input type="checkbox" id='bartscrea' name="bartscrea" class='cboxButton' />
				<label for='bartscrea' style="font-size: 14px; margin-right: 6px;">Arts Creation</label>
			</div>
			<div style="margin-bottom: 15px;">
				<p style="display:inline; margin-right: 23px">Attack Type:</p>
				<input type="checkbox" id='bmelee' name="bmelee" class='cboxButton' />
				<label for='bmelee' style="font-size: 14px; margin-right: 6px;">Melee</label>
				<input type="checkbox" id='branged' name="branged" class='cboxButton' />
				<label for='branged' style="font-size: 14px; margin-right: 6px;">Ranged</label>
				<input type="checkbox" id='bnoatk' name="bnoatk" class='cboxButton' />
				<label for='bnoatk' style="font-size: 14px; margin-right: 6px;">Does Not Attack</label>
			</div>
			<div>
				<p style="display:inline; margin-right: 8px">Damage Type:</p>
				<input type="checkbox" id='bphys' name="bphys" class='cboxButton' />
				<label for='bphys' style="font-size: 14px; margin-right: 6px;">Physical</label>
				<input type="checkbox" id='barts' name="barts" class='cboxButton' />
				<label for='barts' style="font-size: 14px; margin-right: 6px;">Arts</label>
				<input type="checkbox" id='bheal' name="bheal" class='cboxButton' />
				<label for='bheal' style="font-size: 14px; margin-right: 6px;">Healing</label>
			</div>
		</div>

		<div style="width: 95%; margin: auto; margin-top: 30px;">
		<span class="display-6" style="color: white; font-size: 30px;">Browse</span>
		<hr style="color: white; margin: auto; margin-bottom: 30px; margin-top: 20px;" />
		</div>
		
		<div class="enemyWidget" id="enemyWidget"></div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js" integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-kjU+l4N0Yf4ZOJErLsIcvOU2qSb74wXpOhqTvwVx3OElZRweTnQ6d31fXEoRD1Jy" crossorigin="anonymous"></script>

	<script type="text/javascript">
	var eJson;
	fetch('/enemy/enemy_alldata.json')
		.then(response => response.json())
		.then(data => {
			eJson = data;
		
		let enemyInput = document.querySelector('input');
		var searchVal = '';
		var filterArr = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1];
		// normal elite boss inf drone sark poss seamons creat melee ranged doesn'tatk phys arts healing

		for(var i = 0; i < eJson.length; i++) {
			const targetDiv = document.getElementById("enemyWidget");
			name = eJson[i].name;
			source = eJson[i].address;
			caption = eJson[i].index;
			img = `<div class="enemyCard" name="${name}"><figure><img src= ${source} style="width: 80px; height: 80px;"><figcaption>${caption}</figcaption></figure></div>`;
			targetDiv.insertAdjacentHTML('beforeend', img);
		}

		enemyInput.oninput = handleSearch;

		const lightBox = document.createElement('div');
		lightBox.id = 'lightBox';
		document.getElementById('mainDiv').appendChild(lightBox);

		lightBox.addEventListener('click', e => {
			if(e.target != e.currentTarget) return;
			lightBox.classList.remove('active');
		})

		function addBoxToCard() {
			const enemySelect = document.querySelectorAll(".enemyCard");
			enemySelect.forEach(card => {
				card.addEventListener('click', e => {
					lightBox.classList.add('active');
					const infoBox = document.createElement('div');
					// alert(card.getAttribute('name'));
					var tempData;

					for(var i = 0; i < eJson.length; i++) {
						if(eJson[i].name == card.getAttribute('name')) { 
							tempData = eJson[i];
							break;
						}
					}

					infoBox.id = 'infoBox';
					htmlText = `<span class="display-6" style="font-size:35px;">${tempData.name}</span>
						<hr/>
						<div style="display:flex; align-items:center;">
							<figure style="margin-right: 20px;">
								<img src="${tempData.address}" style="width: 100px; height: 100px;">
								<figcaption>${tempData.index}</figcaption>
							</figure>`;

					if(tempData.race == '') {
						htmlText = htmlText.concat(`<p><strong>Level: </strong>${tempData.level}<br><strong>Attack Type: </strong>${tempData.atktype}<br><strong>Damage Type: </strong>${tempData.atkattri}</p></div>`);
					}
					else {
						htmlText = htmlText.concat(`<p><strong>Level: </strong>${tempData.level}<br><strong>Race: </strong>${tempData.race}<br><strong>Attack Type: </strong>${tempData.atktype}<br><strong>Damage Type: </strong>${tempData.atkattri}</p></div>`);
					}

					htmlText = htmlText.concat(`
						<div style="display:flex; align-items:center; justify-content:left; gap:20px; margin-bottom: 18px;">
							<div style="width:70px; height:70px; border: #3e3e3e solid; text-align:center; line-height:70px; position: relative;">
								<img src="/enemy/static/assets/hp.png" style="width: 21px; height: 21px; top:0; left:0; position: absolute; border: #3e3e3e solid">
								<h3 style="margin-top:18px;">${tempData.endure}</h3>
							</div>
							<div style="width:70px; height:70px; border: #3e3e3e solid; text-align:center; line-height:70px; position: relative;">
								<img src="/enemy/static/assets/atk.png" style="width: 21px; hheight: 21px; top:0; left:0; position: absolute; border: #3e3e3e solid">
								<h3 style="margin-top:18px;">${tempData.attack}</h3>
							</div>
							<div style="width:70px; height:70px; border: #3e3e3e solid; text-align:center; line-height:70px; position: relative;">
								<img src="/enemy/static/assets/defense.png" style="width: 21px; height: 21px; top:0; left:0; position: absolute; border: #3e3e3e solid">
								<h3 style="margin-top:18px;">${tempData.defence}</h3>
							</div>
							<div style="width:70px; height:70px; border: #3e3e3e solid; text-align:center; line-height:70px; position: relative;">
								<img src="/enemy/static/assets/resistance.png" style="width: 21px; height: 21px; top:0; left:0; position: absolute; border: #3e3e3e solid">
								<h3 style="margin-top:18px;">${tempData.resistance}</h3>
							</div>
						</div>
						<span class="display-6" style="font-size:25px;">Description</span>
						<hr style="margin-bottom:5px; margin-top:5px;"/>
						<p>${tempData.description}</p>
						<span class="display-6" style="font-size:25px;">Ability</span>
						<hr style="margin-bottom:5px; margin-top:5px;"/>
						<p>${tempData.ability}</p>`)

					for(var i = 0; i < tempData.statlevels; i++) {
						var level = "Level ";
						level = level.concat(i.toString());

						htmlText = htmlText.concat(`
							<span class="display-6" style="font-size:25px;">${level}</span>
							<hr style="margin-bottom:5px; margin-top:5px;"/>
							<table class="table table-sm table-bordered" style="text-align: center; table-layout: fixed;">
								<thead class="thead-light">
									<tr style="background-color: #dbdbdb;">
										<th scope="col">HP</th>
										<th scope="col">Attack</th>
										<th scope="col">Defense</th>
										<th scope="col">Resistance</th>
										<th scope="col">HP Seals</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>${tempData.lhp[i]}</td>
										<td>${tempData.latk[i]}</td>
										<td>${tempData.ldef[i]}</td>
										<td>${tempData.lres[i]}</td>
										<td>${tempData.lseal[i]}</td>
									</tr>
								</tbody>
								<thead class="thead-light">
									<tr style="background-color: #dbdbdb;">
										<th scope="col">ATK Interval</th>
										<th scope="col">ATK Radius</th>
										<th scope="col">Speed</th>
										<th scope="col">Weight</th>
										<th scope="col">HP Regen</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>${tempData.latkint[i]}</td>
										<td>${tempData.lrange[i]}</td>
										<td>${tempData.lmvspd[i]}</td>
										<td>${tempData.lweight[i]}</td>
										<td>${tempData.lregen[i]}</td>
									</tr>
								</tbody>
							</table>
						`)
					}

					htmlText = htmlText.concat(`
						<span class="display-6" style="font-size:25px;">Immunity</span>
						<hr style="margin-bottom:5px; margin-top:5px;"/>
						<p>${tempData.immunity}</p>
						<span class="display-6" style="font-size:25px;">Talents</span>
						<hr style="margin-bottom:5px; margin-top:5px;"/>
						<p>${tempData.talent}</p>
						<span class="display-6" style="font-size:25px;">Skills</span>
						<hr style="margin-bottom:5px; margin-top:5px;"/>`)

					if(tempData.skill == 'None') {
						htmlText = htmlText.concat(`<p>None</p>`);
					}
					else {
						htmlText = htmlText.concat(`
							<table class="table table-sm table-bordered" style="text-align: center;">
								<thead class="thead-light">
									<tr style="background-color: #dbdbdb;">
										<th scope="col">Name</th>
										<th scope="col">Initial</th>
										<th scope="col">Cost</th>
										<th scope="col">Type</th>
										<th scope="col">Effect</th>
									</tr>
								</thead>`);

						for(var j = 0; j < tempData.skillnum; j++) {
							htmlText = htmlText.concat(`
								<tbody>
									<tr>
										<td>${tempData.skill[j].name}</td>
										<td>${tempData.skill[j].initial}</td>
										<td>${tempData.skill[j].cost}</td>
										<td>${tempData.skill[j].type}</td>
										<td>${tempData.skill[j].effect}</td>
									</tr>
								</tbody>`);
						}

						htmlText = htmlText.concat(`</table>`);
					}

					infoBox.innerHTML = htmlText;
					while(lightBox.firstChild) { lightBox.removeChild(lightBox.firstChild); }
					lightBox.appendChild(infoBox);
				});
			});
		}

		addBoxToCard();

		function deleteChildren(parent) {
			while(parent.firstChild) {
				parent.removeChild(parent.firstChild);
			}
		}

		function filterData(data) {
			var filtered = true;
			for(var i = 0; i < filterArr.length; i++) {
				if(filterArr[i] == 1) {
					if(i == 0) {
						if(data.level != 'Normal') { filtered = false; break; }
					}
					if(i == 1) {
						if(data.level != 'Elite') { filtered = false; break; }
					}
					if(i == 2) {
						if(data.level != 'Boss') { filtered = false; break; }
					}
					if(i == 3) {
						if(data.race != 'Infected Creature') { filtered = false; break; }
					}
					if(i == 4) {
						if(data.race != 'Drone') { filtered = false; break; }
					}
					if(i == 5) {
						if(data.race != 'Sarkaz') { filtered = false; break; }
					}
					if(i == 6) {
						if(data.race != 'Possessed') { filtered = false; break; }
					}
					if(i == 7) {
						if(data.race != 'Sea Monster') { filtered = false; break; }
					}
					if(i == 8) {
						if(data.race != 'Arts Creation') { filtered = false; break; }
					}
					if(i == 9) {
						if(data.atktype.includes('Melee') != true) { filtered = false; break; }
					}
					if(i == 10) {
						if(data.atktype.includes('Ranged') != true) { filtered = false; break; }
					}
					if(i == 11) {				
						if(data.atktype.includes('None') != true) { filtered = false; break; }
					}
					if(i == 12) {
						if(data.atkattri != 'Physical') { filtered = false; break; }
					}
					if(i == 13) {
						if(data.atkattri != 'Arts') { filtered = false; break; }
					}
					if(i == 14) {
						if(data.atkattri != 'Healing') { filtered = false; break; }
					}
				}
			}

			return filtered;
		}

		function filterSearch(data) {
			tempName = data.name.toLowerCase();
			tempIndex = data.index.toLowerCase()
			tempVal = searchVal.toLowerCase();
			return (tempName.includes(tempVal) || tempIndex.includes(tempVal));
		}

		function handleSearch(e) {
			searchVal = e.target.value;
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		}

		function filterChildren() {
			var checkVal = true;
			var searchCheck = true;
			for(var j = 0; j < filterArr.length; j++) {
				if(filterArr[j] != -1 || searchVal != '') { checkVal = false; }
				if(filterArr[j] != -1) { searchCheck = false; }
			}

			if(checkVal == true) {
				for(var i = 0; i < eJson.length; i++) {
					const targetDiv = document.getElementById("enemyWidget");
					name = eJson[i].name;
					source = eJson[i].address;
					caption = eJson[i].index;
					img = `<div class="enemyCard" name="${name}"><figure><img src= ${source} style="width: 80px; height: 80px;"><figcaption>${caption}</figcaption></figure></div>`;
					targetDiv.insertAdjacentHTML('beforeend', img);
				}
			}
			else {
				var filteredList = eJson.filter(filterData);

				if(searchVal != '') {
					if(searchCheck == true) { filteredList = eJson.filter(filterSearch); }
					else { filteredList = filteredList.filter(filterSearch); }
				}

				for(var i = 0; i < filteredList.length; i++) {
					const targetDiv = document.getElementById("enemyWidget");
					name = filteredList[i].name;
					source = filteredList[i].address;
					caption = filteredList[i].index;
					img = `<div class="enemyCard" name="${name}"><figure><img src= ${source} style="width: 80px; height: 80px;"><figcaption>${caption}</figcaption></figure></div>`;
					targetDiv.insertAdjacentHTML('beforeend', img);
				}
			}
		}
		
		$("#bnormal").click(function() {
			filterArr[0] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#belite").click(function() {
			filterArr[1] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#bboss").click(function() {
			filterArr[2] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#binfcrea").click(function() {
			filterArr[3] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#bdrone").click(function() {
			filterArr[4] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#bsarkaz").click(function() {
			filterArr[5] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#bpossessed").click(function() {
			filterArr[6] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#bseamon").click(function() {
			filterArr[7] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#bartscrea").click(function() {
			filterArr[8] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#bmelee").click(function() {
			filterArr[9] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#branged").click(function() {
			filterArr[10] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#bnoatk").click(function() {
			filterArr[11] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#bphys").click(function() {
			filterArr[12] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#barts").click(function() {
			filterArr[13] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});

		$("#bheal").click(function() {
			filterArr[14] *= -1
			deleteChildren(document.querySelector('#enemyWidget'));
			filterChildren();
			addBoxToCard();
		});
	});
	</script>
</body>
</html>
